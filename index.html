<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MS Digital Brochure</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    body{
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, sans-serif;
      background: linear-gradient(135deg,#ff6b6b 0%,#a50034 100%);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
      color:#111; user-select:none;
    }
    .wrap{width:min(100%, 900px)}

    .flipbook{
      position:relative; width:100%; aspect-ratio: 1.414;
      background:#fff; border-radius:8px; box-shadow:0 20px 40px rgba(0,0,0,.3); overflow:hidden;
      perspective: 1500px; transform-style: preserve-3d; margin:0 auto;
      -webkit-user-select:none; user-select:none; -webkit-touch-callout:none; -webkit-user-drag:none;
    }

    .spread { 
      position:absolute; inset:0; display:flex;
      transform-style: preserve-3d;
    }

    .page-container {
      position: relative;
      width: 50%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .page {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      backface-visibility: hidden;
      transform-style: preserve-3d;
    }

    .page.front {
      z-index: 2;
    }

    .page.back {
      transform: rotateY(180deg);
      z-index: 1;
    }

    .page.blank { 
      background: #fff !important; 
    }

    .page-container.left { 
      transform-origin: right center;
      border-right: 1px solid rgba(0,0,0,.06);
    }

    .page-container.right { 
      transform-origin: left center;
    }

    .page-container.flipping {
      transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 1000;
    }

    .page-container.flip-left {
      transform: rotateY(180deg);
    }

    .page-container.flip-right {
      transform: rotateY(-180deg);
    }

    /* 그림자 효과 */
    .page-container.flipping::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, 
        rgba(0,0,0,0.1) 0%, 
        rgba(0,0,0,0.3) 50%, 
        rgba(0,0,0,0.1) 100%
      );
      z-index: 10;
      opacity: 0;
      transition: opacity 0.8s ease;
      pointer-events: none;
    }

    .page-container.flipping.shadow::after {
      opacity: 1;
    }

    /* 중앙 스파인 */
    .flipbook::before{
      content:''; position:absolute; top:0; bottom:0; left:50%; width:2px; transform:translateX(-1px);
      background: linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,0) 40%, rgba(0,0,0,.12));
      opacity:.25; pointer-events:none; z-index: 500;
    }

    .controls{ display:flex; justify-content:center; align-items:center; gap:12px; margin-top:20px }
    .nav-btn{
      background:#fff; color:#e60012; border:none; padding:12px 20px; border-radius:999px; cursor:pointer;
      font-size:15px; font-weight:700; transition: transform .15s ease, box-shadow .15s ease; box-shadow:0 6px 18px rgba(230,0,18,.35);
      user-select:none; -webkit-user-select:none;
    }
    .nav-btn:hover{ transform: translateY(-1px); box-shadow:0 10px 24px rgba(230,0,18,.45); }
    .nav-btn:disabled{ opacity:.5; cursor:not-allowed; transform:none; box-shadow:none }

    .loading{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      background: rgba(255,255,255,.95); z-index:2000; gap:10px }
    .spinner{ width:30px; height:30px; border:3px solid #f3f3f3; border-top:3px solid #e60012; border-radius:50%; animation:spin .8s linear infinite }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    @media (max-width: 768px){ .wrap{width:90vw} .nav-btn{ padding:10px 16px; font-size:14px } }
    @media (prefers-reduced-motion: reduce){ .page-container{ transition:none !important } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="flipbook" id="flipbook" aria-label="Flipbook">
      <div class="loading" id="loading"><div class="spinner"></div><div>Loading pages…</div></div>
    </div>

    <div class="controls" aria-label="Pagination controls">
      <button class="nav-btn" id="prevBtn">← Previous</button>
      <button class="nav-btn" id="nextBtn">Next →</button>
    </div>
  </div>

  <script>
    const CONFIG = {
      imagePrefix: 'pg',
      imageExtensions: ['jpg','jpeg','png','webp'],
      maxPagesToCheck: 100,
      loadingTimeout: 5000,
      preloadAhead: 2,
      animationDuration: 800
    };

    let totalImages = 0, currentSpread = 0, isAnimating = false;
    const pages = [];
    const preloaded = new Set();

    const $ = s => document.querySelector(s);
    const flipbook = $('#flipbook'), loading = $('#loading');
    const prevBtn = $('#prevBtn'), nextBtn = $('#nextBtn');

    prevBtn.addEventListener('click', previousPage);
    nextBtn.addEventListener('click', nextPage);

    document.addEventListener('keydown', e=>{
      if(['ArrowLeft','ArrowUp'].includes(e.key)){ e.preventDefault(); previousPage(); }
      if(['ArrowRight','ArrowDown'].includes(e.key)){ e.preventDefault(); nextPage(); }
    });

    flipbook.addEventListener('contextmenu', e=>e.preventDefault());
    document.addEventListener('dragstart', e=>e.preventDefault());

    async function init(){
      const detected = await detectPages();
      if(detected.length === 0){
        loading.innerHTML = `<div style="color:#e74c3c;text-align:center"><strong>No pages found</strong><br>Place images in the same folder as this HTML file.<br>Name them: <code>${CONFIG.imagePrefix}1.jpg</code>, <code>${CONFIG.imagePrefix}2.jpg</code>, etc.<br><small>Supported formats: ${CONFIG.imageExtensions.join(', ')}</small></div>`;
        updateControls(); return;
      }

      pages.length = 0;
      pages.push(null); // Page 0 (blank for left side of cover)
      detected.forEach(page => pages.push(page));

      totalImages = pages.length - 1;
      createSpread();
      
      loading.style.display = 'none';
      updateControls();
      preloadAround(currentSpread);
    }

    function createSpread() {
      const spread = document.createElement('div');
      spread.className = 'spread';
      
      // Left page container
      const leftContainer = document.createElement('div');
      leftContainer.className = 'page-container left';
      leftContainer.id = 'leftContainer';
      
      // Right page container  
      const rightContainer = document.createElement('div');
      rightContainer.className = 'page-container right';
      rightContainer.id = 'rightContainer';
      
      spread.appendChild(leftContainer);
      spread.appendChild(rightContainer);
      flipbook.appendChild(spread);
      
      updateSpreadContent();
    }

    function updateSpreadContent() {
      const leftContainer = $('#leftContainer');
      const rightContainer = $('#rightContainer');
      
      // Clear existing pages
      leftContainer.innerHTML = '';
      rightContainer.innerHTML = '';
      
      const leftPageIndex = currentSpread * 2;
      const rightPageIndex = currentSpread * 2 + 1;
      
      // Left side - front and back
      createPagePair(leftContainer, leftPageIndex, leftPageIndex + 2);
      
      // Right side - front and back
      createPagePair(rightContainer, rightPageIndex, rightPageIndex + 2);
    }

    function createPagePair(container, frontIndex, backIndex) {
      // Front page
      const front = document.createElement('div');
      front.className = 'page front';
      
      if(frontIndex < pages.length && pages[frontIndex]) {
        front.style.backgroundImage = `url('${pages[frontIndex].path}')`;
      } else {
        front.classList.add('blank');
      }
      
      // Back page (what shows when flipped)
      const back = document.createElement('div');
      back.className = 'page back';
      
      if(backIndex < pages.length && pages[backIndex]) {
        back.style.backgroundImage = `url('${pages[backIndex].path}')`;
        // Mirror the back page so it reads correctly when flipped
        back.style.transform = 'rotateY(180deg) scaleX(-1)';
      } else {
        back.classList.add('blank');
        back.style.transform = 'rotateY(180deg)';
      }
      
      container.appendChild(front);
      container.appendChild(back);
    }

    function nextPage() {
      if(isAnimating) return;
      
      const maxSpreads = Math.ceil(totalImages / 2);
      if(currentSpread >= maxSpreads - 1) return;
      
      isAnimating = true;
      updateControls();
      
      const rightContainer = $('#rightContainer');
      
      rightContainer.classList.add('flipping', 'shadow');
      
      requestAnimationFrame(() => {
        rightContainer.classList.add('flip-right');
      });
      
      setTimeout(() => {
        currentSpread++;
        updateSpreadContent();
        resetAnimations();
        isAnimating = false;
        updateControls();
        preloadAround(currentSpread);
      }, CONFIG.animationDuration);
    }

    function previousPage() {
      if(isAnimating || currentSpread <= 0) return;
      
      isAnimating = true;
      updateControls();
      
      const leftContainer = $('#leftContainer');
      
      leftContainer.classList.add('flipping', 'shadow');
      
      requestAnimationFrame(() => {
        leftContainer.classList.add('flip-left');
      });
      
      setTimeout(() => {
        currentSpread--;
        updateSpreadContent();
        resetAnimations();
        isAnimating = false;
        updateControls();
        preloadAround(currentSpread);
      }, CONFIG.animationDuration);
    }

    function resetAnimations() {
      const containers = [document.getElementById('leftContainer'), document.getElementById('rightContainer')];
      containers.forEach(container => {
        if(container) {
          container.classList.remove('flipping', 'shadow', 'flip-left', 'flip-right');
        }
      });
    }

    function updateControls(){
      const maxSpreads = Math.ceil(totalImages / 2);
      prevBtn.disabled = (currentSpread <= 0) || isAnimating;
      nextBtn.disabled = (currentSpread >= maxSpreads - 1) || isAnimating;
    }

    function preloadAround(spread){
      const paths = [];
      for(let d = -CONFIG.preloadAhead; d <= CONFIG.preloadAhead; d++){
        const s = spread + d;
        const leftIndex = s * 2;
        const rightIndex = s * 2 + 1;
        
        [leftIndex, rightIndex, leftIndex + 2, rightIndex + 2].forEach(index => {
          if(index > 0 && index < pages.length && pages[index]) {
            paths.push(pages[index].path);
          }
        });
      }
      
      paths.forEach(path => {
        if(preloaded.has(path)) return;
        const img = new Image();
        img.decoding = 'async'; 
        img.loading = 'eager'; 
        img.src = path;
        preloaded.add(path);
      });
    }

    async function detectPages(){
      const found = [];
      for(let i = 1; i <= CONFIG.maxPagesToCheck; i++){
        let ok = false, pickedPath = '';
        for(const ext of CONFIG.imageExtensions){
          const src = `${CONFIG.imagePrefix}${i}.${ext}`;
          const exists = await checkImage(src);
          if(exists){ ok = true; pickedPath = src; break; }
        }
        if(ok){ found.push({number: i, path: pickedPath}); }
        else if(found.length > 0){ break; }
      }
      return found;
    }

    function checkImage(src){
      return new Promise((resolve) => {
        const img = new Image();
        let done = false;
        const timeout = setTimeout(() => { 
          if(!done){ done = true; resolve(false); } 
        }, CONFIG.loadingTimeout);
        
        img.onload = () => { 
          if(!done){ done = true; clearTimeout(timeout); resolve(true); } 
        };
        img.onerror = () => { 
          if(!done){ done = true; clearTimeout(timeout); resolve(false); } 
        };
        img.src = src + `?v=${Date.now()}`;
      });
    }

    init();
  </script>
</body>
</html>
